# API для отправки сообщений через Telegram

Данный проект представляет собой серверное приложение на Node.js, реализующее API для авторизации в Telegram и отправки сообщений через аккаунт пользователя с использованием библиотеки GramJS.

Проект разработан в соответствии с техническим заданием и полностью функционален. Все компоненты работают стабильно, обрабатывают ошибки и обеспечивают безопасность конфиденциальных данных.

---

## Установка и настройка

### Шаг 1: Скачивание проекта

Скопируйте репозиторий или скачайте архив с проектом на локальный компьютер. Распакуйте его в удобную папку.

### Шаг 2: Установка зависимостей

Перейдите в папку проекта и откройте терминал (или командную строку):

```bash
npm install
```
Ожидайте завершения установки. В процессе будет загружено около 50–100 МБ данных.

### Шаг 3: Настройка переменных окружения
В корне проекта создайте файл с именем `.env` и откройте его в любом текстовом редакторе.

Добавьте следующие строки:

env
API_ID=ваш_api_id       # Формат: число

API_HASH="ваш_api_hash" # Формат: строка в двойных кавычках

PORT=3000               # Порт сервера (по умолчанию 3000)

---

Как получить API_ID и API_HASH?

Перейдите на сайт https://my.telegram.org

Авторизуйтесь под своим номером телефона

Перейдите в раздел API development tools

Нажмите Create application

Заполните поля:

App title — любое название (например, "MyApp")

Short name — например, "myapp"

Нажмите Create

Скопируйте значения:

App api_id → вставьте вместо ваш_api_id

App api_hash → вставьте вместо ваш_api_hash, обязательно в двойных кавычках

Пример корректного файла `.env`:

env

API_ID=1234567

API_HASH="abcdef1234567890abcdef1234567890"

PORT=3000

Внимание: файл `.env` содержит конфиденциальные данные. Не передавайте его третьим лицам и не загружайте в публичные репозитории. Он добавлен в .gitignore и не должен попадать в систему контроля версий.
---
Запуск приложения
После настройки выполните команду:

```bash
node index.js
```
Вы увидите сообщение:

server started on port: 3000

file session doesn't finded, now it will be created

client connected to server

no valid session found

Please enter your number:

Авторизация в Telegram

После запуска приложение запросит номер телефона:

Please enter your number:

Введите свой номер телефона в международном формате, например:

+79141112233

Нажмите Enter.

Если у вас включена двухфакторная аутентификация (2FA), появится запрос:

Please enter your password:

Введите пароль от аккаунта.

Затем введите код, который пришлёт Telegram:

Please enter the code you received:

После успешной авторизации появится сообщение:

you should now be connected.

session saved in session.txt

Файл session.txt будет создан в корне проекта. Он содержит зашифрованную сессию и позволяет избежать повторной авторизации при следующих запусках.
---
Работа с API

Сервер запущен на порту 3000. Доступны следующие эндпоинты.

1. Проверка статуса авторизации
Метод: GET
Адрес: http://localhost:3000/auth/status

Ответ при успешной авторизации:

json
{ "authorized": true }
Ответ, если сессия недействительна или отсутствует:

json
{ "authorized": false }
2. Отправка сообщения
Метод: POST
Адрес: http://localhost:3000/messages/send
Тип содержимого: application/json

Пример тела запроса:

json
{
  "phone": "+79141112233",
  "message": "Привет! Это тестовое сообщение."
}
Поддерживаемые форматы номера:

+79141112233 — с плюсом
79141112233 — без плюса
89141112233 — с восьмёркой (автоматически преобразуется в +7)
Возможные ответы
| Код | Ответ | Причина | |-----|-------|--------| | 200 | { "success": true, "sentTo": "+7..." } | Сообщение отправлено | | 400 | { "success": false, "error": "INVALID_INPUT" } | Пустые поля или сообщение из пробелов | | 400 | { "success": false, "error": "INVALID_PHONE" } | Неверный формат номера (слишком короткий, содержит недопустимые символы) | | 400 | { "success": false, "error": "USER_NOT_FOUND" } | Пользователь не найден в Telegram | | 401 | { "success": false, "error": "NOT_AUTHORIZED" } | Не выполнена авторизация | | 429 | { "success": false, "error": "FLOOD_WAIT" } | Слишком много запросов — нужно подождать | | 500 | { "success": false, "error": "SEND_FAILED" } | Ошибка отправки (например, пустое сообщение) |

Особенности реализации
Используется официальная библиотека telegram (GramJS)
Поддержка сохранения сессии в файл session.txt
Автоматическая нормализация номеров телефонов:
Номера, начинающиеся с 8, преобразуются в +7
Номера, начинающиеся с 7, преобразуются в +7
Все номера приводятся к формату +<код><номер>
Проверка авторизации перед отправкой сообщения
Полная обработка ошибок на всех этапах
Поддержка международных номеров (начинающихся с +1, +44 и т. д.)
Явная настройка параметров клиента:
langCode: "ru"
systemLangCode: "ru-RU"
Имитация устройства для повышения доверия со стороны Telegram
Безопасность
Конфиденциальные данные (API_ID, API_HASH) хранятся в файле `.env`
Сессия хранится в виде строки в session.txt — не содержит паролей
Пароль от аккаунта вводится только один раз и нигде не сохраняется
Файлы `.env` и session.txt добавлены в .gitignore — не попадают в репозиторий
Устранение типичных проблем
1. Не приходит код на телефон
Убедитесь, что номер введён правильно
Проверьте интернет-соединение
Убедитесь, что номер привязан к аккаунту Telegram
Попробуйте перезапустить приложение
2. Ошибка TIMEOUT в консоли
Это стандартное поведение библиотеки GramJS при фоновом подключении. Не является критической ошибкой и не влияет на работу приложения.

3. Сообщение не отправляется, ошибка USER_NOT_FOUND
Убедитесь, что получатель зарегистрирован в Telegram
Попробуйте начать чат с этим пользователем вручную через приложение Telegram
Проверьте правильность номера
4. Сервер не запускается
Убедитесь, что установлен Node.js (проверьте командой node --version)
Убедитесь, что выполнена команда npm install
Проверьте, нет ли опечаток в файле `.env`
Технологии
Node.js (v18+)
Express
GramJS (библиотека telegram)
dotenv — для загрузки переменных окружения
JavaScript (ESM — модульная система)
